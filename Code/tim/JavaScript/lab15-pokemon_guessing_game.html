
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Poke-Guess</title>
    <link href="https://fonts.googleapis.com/css?family=Jua" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.1"></script>
    <script src="http://pokeapi.co/api/v2/language/9/"></script>
    <style>
        body {
            margin: 20px;
            background-color: black;
            color: white;
            text-align: center;
            font-size: 1em;
            font-family: 'Jua', sans-serif;
        }
        #reg_label, #hard_label, #ability_label {
            margin-right: 50px;
        }
        #options_container {
            margin-top: 50px;
            margin-bottom: 50px;
        }
        #options_container > label {
            font-size: 2em;
        }
        #play_container {
            display: inline-flex;
            margin-bottom: 20px;
        }
        #play_container > div {
            font-size: 3em;
        }
        #play_container > input {
            font-size: 2em;
            width: 50px;
            text-align: center;
        }
        #play_container *:not(:last-child) {
            margin-right: 20px;
        }
        button{
            font-size: 2em;
            width: 100px;
        }
        p {
            font-size: 2em;
            word-break: break-word;
            white-space: normal;
            width: 200px;
        }
        .choice_img {
            margin: 10px;
            border: 1px solid white;
        }
        .model_img {
            height: 50%;
            width: auto;
        }
        img:hover {
            cursor: pointer;
            border: 1px solid red;
        }
        #question_div {
            margin-top: 1em;
            font-size: 3em;
        }
        #modal_background {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }
        #character_modal {
            display: flex;
            background-color: #fefefe;
            margin: 10% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 60%;
            height: 50%;
            color: black;
        }
        #picture_container {
            flex: 3;
            display: flex;
            flex-direction: column;
            border: 1px solid black;
            width: 10%;
            height: auto;
        }
        #label_container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        #info_container {
            flex: 10;
            display: flex;
            flex-direction: column;
            text-align: left;
        }
        #picture_container * {
            flex: 2;
        }
        /*#label_container *, #info_container * {*/
            /*transform: translateY(50%)*/
        /*}*/
        /*#info_container *:not(:last-child) {*/
            /*font-size: 3em;*/
        /*}*/
        .row_0, .row_1, .row_2, .row_3 {
            flex: 1;
        }
        .row_4 {
            flex: 4;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="options_container">
            <input type="radio" name="mode" checked="checked" v-on:click="set_mode('regular')">
            <label id="reg_label">Regular</label>
            <input type="radio" name="mode" v-on:click="set_mode('hard')">
            <label id="hard_label">Hard</label>
            <input type="radio" name="mode" v-on:click="set_mode('abilities')">
            <label id="ability_label">Ability</label>
            <input type="radio" name="mode" v-on:click="set_mode('moves')">
            <label>Move</label>
        </div>
        <div id="play_container">
            <div>how many pokemon</div>
            <input type="text" v-model="game_count">
            <button v-on:click="choose_play" style="background-color: limegreen"><b>play</b></button>
            <button v-on:click="show_hint" style="background-color: dodgerblue"><b>hint</b></button>
        </div>
        <br>
        <div text-align="center" v-for="poke in pokemon" style="display: inline-flex">
            <div style="display: inline-flex; flex-direction: column">
                <img class="choice_img" width="200px" height="auto" v-bind:src="poke.img_front" v-on:click="show_modal(poke)"/>
                <p>{{ poke.hint }}</p>
            </div>
        </div>
        <div id="question_div" v-if="pokemon.length == game_count">{{ question }}</div>
        <div id="modal_background" v-bind:style="style_obj" v-on:click="hide_modal">
            <div id="character_modal">
                <div id="picture_container">
                    <img class="modal_img" v-bind:src="modal_obj.img_front"/>
                    <img class="modal_img" v-bind:src="modal_obj.img_back"/>
                </div>
                <div id="label_container">
                    <div class="row_0">Answer</div>
                    <div class="row_1">Name</div>
                    <div class="row_2">Types</div>
                    <div class="row_3">Abilities</div>
                    <div class="row_4">Moves</div>
                </div>
                <div id="info_container">
                    <div class="row_0">{{ modal_obj.correct }}</div>
                    <div class="row_1">{{ modal_obj.name }}</div>
                    <div class="row_2">{{ build_comma_list(modal_obj.types) }}</div>
                    <div class="row_3">{{ build_comma_list(modal_obj.abilities) }}</div>
                    <div class="row_4">{{ build_comma_list(modal_obj.moves) }}</div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let app = new Vue({
            el: '#app',
            data: {
                game_count: 3,
                pokemon: [],
                correct_index: 0,
                poke_count: 0,
                question: '',
                correct_answer: {},
                play_mode: 'regular',
                num_of_types: 18,
                style_obj: {display: 'none'},
                modal_obj: {
                    name: '',
                    img_front: '',
                    img_back: '',
                    stats: [],
                    types: [],
                    abilities: [],
                    moves: [],
                    hint: '',
                    correct: ''
                }
            },
            methods: {
                set_mode (curr_mode) {
                    this.play_mode = curr_mode
                },
                choose_play() {
                    this.pokemon = []
                    switch(this.play_mode) {
                        case 'regular':
                            this.play_regular()
                            break
                        case 'hard':
                            this.play_hard()
                            break
                        case 'abilities':
                            this.play_abilities()
                            break
                        case 'moves':
                            this.play_moves()
                            break
                    }
                },
                show_hint() {
                    for (let i=0; i<this.pokemon.length; i++) {
                        let poke = this.pokemon[i]
                        switch (this.play_mode) {
                            case 'regular':
                                poke.hint = 'types: ' + this.build_comma_list(poke.types)
                                break
                            case 'hard':
                                poke.hint = 'types: ' + this.build_comma_list(poke.types)
                                break
                            case 'abilities':
                                poke.hint = 'name: ' + poke.name
                                break
                            case 'moves':
                                poke.hint = 'name: ' + poke.name
                                break
                        }
                    }
                },
                build_comma_list(arr_in) {
                    let str_out = ''
                    for (let i=0; i<arr_in.length; i++) {
                        str_out += arr_in[i] + ', '
                    }
                    return str_out.slice(0, str_out.length - 2)
                },
                build_poke_obj(data) {
                    let poke_types = []
                    for (let i=0; i<data.types.length; i++) {
                        poke_types.push(data.types[i].type.name)
                    }
                    let poke_abilities = []
                    for (let i=0; i<data.abilities.length; i++) {
                        poke_abilities.push(data.abilities[i].ability.name)
                    }
                    let poke_moves = []
                    for (let i=0; i<data.moves.length; i++) {
                        poke_moves.push(data.moves[i].move.name)
                    }
                    return {
                        name: data.name,
                        img_front: data.sprites.front_default,
                        img_back: data.sprites.back_default,
                        stats: data.stats,
                        types: poke_types,
                        abilities: poke_abilities,
                        moves: poke_moves,
                        hint: '',
                        correct: ''
                    }
                },
                play_regular() {
                    for (let i=0; i<this.game_count; i++) {
                        let rand_index = Math.floor(Math.random() * this.poke_count) + 1
                        this.$http.get('http://pokeapi.co/api/v2/pokemon/' + rand_index).then(response => {
                            let poke_obj = this.build_poke_obj(response.body)
                            this.pokemon.push(poke_obj)
                            if (this.pokemon.length == this.game_count) {
                                let random_poke = this.pokemon[Math.floor(Math.random() * this.game_count)]
                                this.correct_answer = random_poke
                                this.question = 'Which one is ' + random_poke.name + '?'
                            }
                        }, response => {
                            alert('something went wrong')
                        })
                    }
                },
                play_hard() {
                    let rand_type = Math.floor(Math.random() * this.num_of_types) + 1
                    this.$http.get('http://pokeapi.co/api/v2/type/' + rand_type).then(response => {
                        let type_data = response.body
                        let num_of_pokemon = type_data.pokemon.length
                        let url_list = []
                        for (let i=0; i<this.game_count*2+5; i++) {
                            let rand_url = type_data.pokemon[Math.floor(Math.random() * num_of_pokemon)].pokemon.url
                            url_list.push(rand_url)
                        }
                        let image_checker = []
                        for (let i=0; i<url_list.length; i++) {
                            this.$http.get(url_list[i]).then(response => {
                                let poke_obj = this.build_poke_obj(response.body)
                                image_checker.push(poke_obj)
                                if (image_checker.length === url_list.length) {
                                    for (let j=0; j<image_checker.length; j++) {
                                        if (image_checker[j].img_front) {
                                            this.pokemon.push(image_checker[j])
                                            if (this.pokemon.length == this.game_count) {
                                                let random_poke_index = Math.floor(Math.random() * this.game_count)
                                                let random_poke = this.pokemon[random_poke_index]
                                                this.correct_answer = random_poke
                                                this.question = 'Which one is ' + random_poke.name + '?'
                                                return
                                            }
                                        }
                                    }
                                }
                            }, response => {
                                alert('something went wrong')
                            })
                        }
                    }, response => {
                        alert('something went wrong')
                    })
                },
                play_abilities() {
                    for (let i=0; i<this.game_count; i++) {
                        let rand_index = Math.floor(Math.random() * this.poke_count) + 1
                        this.$http.get('http://pokeapi.co/api/v2/pokemon/' + rand_index).then(response => {
                            let poke_obj = this.build_poke_obj(response.body)
                            this.pokemon.push(poke_obj)
                            if (this.pokemon.length == this.game_count) {
                                let rand_index = Math.floor(Math.random() * this.game_count)
                                let rand_poke = this.pokemon[rand_index]
                                this.correct_answer = rand_poke
                                for (let j=0; j<this.pokemon[rand_index].abilities.length; j++) {
                                    let unique_ability = true
                                    let t_ability = this.pokemon[rand_index].abilities[j]
                                    for (let k=0; k<this.game_count; k++) {
                                        if (rand_index === k) continue
                                        if (this.pokemon[k].abilities.indexOf(t_ability) > -1) {
                                            unique_ability = false
                                            break
                                        }
                                    }
                                    if (unique_ability) {
                                        this.question = 'Which one has the ability "' + t_ability + '"?'
                                        break
                                    }
                                }
                            }
                        }, response => {
                            alert('something went wrong')
                        })
                    }
                },
                play_moves() {
                    for (let i=0; i<this.game_count; i++) {
                        let rand_index = Math.floor(Math.random() * this.poke_count) + 1
                        this.$http.get('http://pokeapi.co/api/v2/pokemon/' + rand_index).then(response => {
                            let poke_obj = this.build_poke_obj(response.body)
                            this.pokemon.push(poke_obj)
                            if (this.pokemon.length == this.game_count) {
                                let rand_index = Math.floor(Math.random() * this.game_count)
                                let rand_poke = this.pokemon[rand_index]
                                this.correct_answer = rand_poke
                                for (let j=0; j<this.pokemon[rand_index].moves.length; j++) {
                                    let unique_move = true
                                    let t_move = this.pokemon[rand_index].moves[j]
                                    for (let k=0; k<this.game_count; k++) {
                                        if (rand_index === k) continue
                                        if (this.pokemon[k].moves.indexOf(t_move) > -1) {
                                            unique_move = false
                                            break
                                        }
                                    }
                                    if (unique_move) {
                                        this.question = 'Which one has the move "' + t_move + '"?'
                                        break
                                    }
                                }
                            }
                        }, response => {
                            alert('something went wrong')
                        })
                    }
                },
                hide_modal(poke) {
                    this.style_obj = {display: 'none'}
                    if (this.modal_obj.correct === 'Correct!') this.choose_play()
                },
                show_modal(poke) {
                    if (this.correct_answer.name === poke.name) {
                        poke.correct = 'Correct!'
                    } else {
                        poke.correct= 'Wrong!'
                    }
                    this.modal_obj = poke
                    this.style_obj = {display: 'flex'}
                }
            },
            created: function () {
                this.$http.get('http://pokeapi.co/api/v2/pokemon-species/?limit=0').then(response => {
                    this.poke_count = response.body.count
                })
            }
        })
    </script>
</body>
</html>